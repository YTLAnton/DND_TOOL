<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5E 命定職業與子職業測驗</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #c0392b; /* 龍息紅 */
            --secondary-color: #2c3e50; /* 深岩灰 */
            --accent-color: #f1c40f; /* 金幣黃 */
            --text-color: #ecf0f1;
            --bg-color: #1a1a1d;
            --card-bg: #2d3436;
            --disabled-color: #7f8c8d;
            --highlight-bg: rgba(241, 196, 15, 0.15);
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #4b130f, #2c3e50);
            width: 100%;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-bottom: 3px solid var(--accent-color);
            box-sizing: border-box;
        }

        h1 {
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px #000;
            line-height: 1.2;
        }

        p.subtitle {
            color: #bdc3c7;
            margin-top: 0.5rem;
            font-size: 1rem;
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* 卡片共用樣式 */
        #start-screen, #quiz-container, .result-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            padding: 3rem; 
        }

        #start-screen {
            text-align: center;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin-top: 2rem;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
        }

        .btn:hover {
            background-color: #e74c3c;
            transform: scale(1.05);
        }

        /* Quiz Container */
        #quiz-container {
            display: none;
            position: relative;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .option-btn {
            background-color: #34495e;
            color: var(--text-color);
            border: 1px solid #4a69bd;
            padding: 1rem 1.5rem;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            background-color: #4a69bd;
            transform: translateX(5px);
        }

        .option-btn.selected {
            background-color: #4a69bd;
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.6);
            font-weight: bold;
        }

        /* 導覽按鈕 */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid #7f8c8d;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            flex: 1;
        }

        .nav-btn:hover:not(:disabled) {
            background-color: #34495e;
            border-color: var(--text-color);
        }

        .nav-btn:disabled {
            background-color: #2c3e50;
            color: var(--disabled-color);
            border-color: #444;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Result Screen */
        #result-screen {
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-card {
            text-align: center;
            border-top: 5px solid var(--accent-color);
        }

        .class-icon {
            font-size: 4rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .result-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .result-subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .result-desc {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            text-align: left;
            background: rgba(0,0,0,0.2);
            padding: 1.5rem;
            border-radius: 10px;
        }

        .subclass-box {
            text-align: left;
            margin-top: 2rem;
            border-top: 1px solid #555;
            padding-top: 1rem;
        }

        .subclass-title {
            color: var(--accent-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
            padding-bottom: 0.5rem;
        }

        .subclass-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            transition: transform 0.2s;
        }

        .subclass-item strong {
            color: #fff;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .subclass-item p {
            margin: 0;
            color: #bdc3c7;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* 第一名推薦樣式 */
        .subclass-item.best-match {
            background: var(--highlight-bg);
            border-left: 4px solid var(--accent-color);
            transform: scale(1.02);
        }

        .footer {
            margin-top: 2rem;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-bottom: 2rem;
        }

        /* RWD */
        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
            .nav-btn {
                flex: 0 0 auto;
                min-width: 120px;
            }
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .container { width: 95%; margin: 1rem auto; }
            #start-screen, #quiz-container, .result-card { padding: 1.5rem 1rem; }
            .question-text { font-size: 1.2rem; margin-bottom: 1.5rem; }
            .option-btn { padding: 1rem; font-size: 1rem; }
            .result-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-dice-d20"></i> D&D 5E 職業適性測驗</h1>
    <p class="subtitle">探索你的命定職業與子職業 (包含 TCE/XGE 擴充)</p>
</header>

<div class="container">
    <div id="start-screen">
        <h2>冒險者，歡迎來到費倫大陸</h2>
        <p>這份測驗根據你選擇的戰鬥風格、決策模式與內在價值觀。</p>
        <p>從 12 個基礎職業中鎖定適合的職業，並推薦<strong>子職業</strong>。</p>
        <button class="btn" onclick="startQuiz()">開始測驗</button>
    </div>

    <div id="quiz-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div id="question-box">
            <h3 class="question-text" id="question-text">題目載入中...</h3>
            <div class="options-grid" id="options-box">
                </div>
            
            <div class="nav-buttons">
                <button id="prev-btn" class="nav-btn" onclick="prevQuestion()"><i class="fas fa-arrow-left"></i> 上一題</button>
                <button id="next-btn" class="nav-btn" onclick="handleNextClick()">下一題 <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <div id="result-screen">
        <div class="result-card">
            <div class="class-icon" id="result-icon"></div>
            <h2 class="result-title" id="result-title"></h2>
            <p class="result-subtitle" id="result-flavor"></p>
            
            <div class="result-desc" id="result-description"></div>

            <div class="subclass-box">
                <h3 class="subclass-title">命運指引：推薦子職業</h3>
                <div id="subclass-recommendations"></div>
            </div>

            <button class="btn" onclick="restartQuiz()">重新測驗</button>
            <br><br>
        </div>
    </div>
</div>

<div class="footer">
    <p>Designed based on D&D 5E Rules (PHB, XGE, TCE).</p>
</div>

<script>
    // --------------------------------------------------------------------------------
    // Tags Definition (用於子職業推薦演算法):
    // melee(近戰), range(遠程), magic(魔法), physical(物理), 
    // tank(肉盾), support(支援/治療), damage(輸出), control(控場), utility(功能/解謎)
    // stealth(隱匿), social(社交), nature(自然), holy(神聖), dark(黑暗/邪惡)
    // simple(簡單/直覺), complex(複雜/戰術), chaos(混亂/隨機), pet(寵物/召喚)
    // --------------------------------------------------------------------------------

    const questions = [
        {
            text: "1. 當你遇到一扇深鎖的厚重木門，而門後可能藏有寶藏，你的第一直覺是？",
            options: [
                { text: "一腳踹開它！省時省力。", scores: { barbarian: 3, fighter: 1, paladin: 1 }, tags: ['simple', 'melee', 'aggressive'] },
                { text: "拿出開鎖工具，安靜且優雅地打開它。", scores: { rogue: 3, bard: 1, ranger: 1 }, tags: ['stealth', 'utility'] },
                { text: "施展魔法將鎖融化或傳送進去。", scores: { wizard: 2, sorcerer: 2, warlock: 1 }, tags: ['magic', 'utility'] },
                { text: "仔細觀察周圍是否有機關或鑰匙。", scores: { monk: 2, cleric: 1, druid: 1 }, tags: ['utility', 'cautious', 'perception'] }
            ]
        },
        {
            text: "2. 在戰鬥中，你更喜歡站在什麼位置？",
            options: [
                { text: "衝在最前線，與敵人面對面肉搏。", scores: { barbarian: 3, fighter: 2, paladin: 2, monk: 1 }, tags: ['melee', 'tank'] },
                { text: "站在後方，用強大的法術轟炸敵人。", scores: { wizard: 3, sorcerer: 3, warlock: 2 }, tags: ['magic', 'range', 'damage'] },
                { text: "遊走於戰場邊緣，尋找偷襲或射擊的機會。", scores: { rogue: 3, ranger: 3, monk: 1 }, tags: ['stealth', 'range', 'mobility'] },
                { text: "在隊伍中間，隨時準備治療隊友或支援戰局。", scores: { cleric: 3, bard: 2, druid: 2 }, tags: ['support', 'healing'] }
            ]
        },
        {
            text: "3. 你的力量來源是什麼？",
            options: [
                { text: "透過經年累月的嚴格鍛鍊與武藝修習。", scores: { fighter: 3, monk: 3, rogue: 1 }, tags: ['physical', 'discipline'] },
                { text: "與生俱來的血統或天賦。", scores: { sorcerer: 3, barbarian: 1 }, tags: ['magic', 'innate'] },
                { text: "來自神祇、大自然或崇高誓言的賜福。", scores: { cleric: 3, paladin: 3, druid: 3, warlock: 1 }, tags: ['holy', 'nature', 'divine'] },
                { text: "透過研讀古籍與知識獲得的奧秘。", scores: { wizard: 3, bard: 1 }, tags: ['magic', 'knowledge'] }
            ]
        },
        {
            text: "4. 如果隊友受了重傷，你會怎麼做？",
            options: [
                { text: "立刻施展治癒法術，這是我的職責。", scores: { cleric: 3, druid: 2, bard: 1, paladin: 1 }, tags: ['healing', 'support', 'holy'] },
                { text: "站在他身前，擋下攻擊，保護他撤退。", scores: { paladin: 3, fighter: 2, barbarian: 2 }, tags: ['tank', 'defense'] },
                { text: "憤怒地將傷害他的敵人撕成碎片。", scores: { barbarian: 3, warlock: 1 }, tags: ['damage', 'aggressive', 'revenge'] },
                { text: "使用藥水或急救包，或者用魔法道具。", scores: { rogue: 1, ranger: 1 }, tags: ['utility', 'item'] }
            ]
        },
        {
            text: "5. 你最喜歡在哪種環境下冒險？",
            options: [
                { text: "茂密的森林或荒野，遠離文明。", scores: { druid: 3, ranger: 3, barbarian: 2 }, tags: ['nature', 'survival'] },
                { text: "繁華的城市，充滿人群與政治鬥爭。", scores: { bard: 3, rogue: 2, wizard: 1 }, tags: ['social', 'urban'] },
                { text: "陰暗的地下城或古代遺跡。", scores: { rogue: 2, fighter: 1, warlock: 1 }, tags: ['stealth', 'dungeon', 'dark'] },
                { text: "神聖的神殿或修道院。", scores: { cleric: 3, paladin: 2, monk: 2 }, tags: ['holy', 'discipline'] }
            ]
        },
        {
            text: "6. 面對一個強大惡魔領主的威脅，你會試圖？",
            options: [
                { text: "與它簽訂契約，換取更強大的力量。", scores: { warlock: 3, sorcerer: 1 }, tags: ['dark', 'power', 'risk'] },
                { text: "以神聖的光芒將它淨化驅逐。", scores: { paladin: 3, cleric: 3 }, tags: ['holy', 'damage'] },
                { text: "分析它的弱點，用針對性的法術攻擊。", scores: { wizard: 3, ranger: 1 }, tags: ['knowledge', 'tactics'] },
                { text: "嘲笑它，干擾它的注意力，讓隊友進攻。", scores: { bard: 3, rogue: 1 }, tags: ['social', 'control'] }
            ]
        },
        {
            text: "7. 你認為什麼是解決問題的最佳工具？",
            options: [
                { text: "一把鋒利的大斧或巨劍。", scores: { barbarian: 3, fighter: 2 }, tags: ['melee', 'simple', 'damage'] },
                { text: "一本寫滿咒語的法術書。", scores: { wizard: 3 }, tags: ['magic', 'utility', 'complex'] },
                { text: "三寸不爛之舌與個人魅力。", scores: { bard: 3, sorcerer: 2, warlock: 1 }, tags: ['social', 'manipulation'] },
                { text: "敏銳的直覺與隱密的行動。", scores: { rogue: 3, ranger: 2, monk: 1 }, tags: ['stealth', 'perception'] }
            ]
        },
        {
            text: "8. 休息時間（長休）你通常在做什麼？",
            options: [
                { text: "保養武器和盔甲，保持最佳狀態。", scores: { fighter: 2, paladin: 2 }, tags: ['discipline', 'physical'] },
                { text: "祈禱、冥想，或與自然連結。", scores: { cleric: 2, monk: 2, druid: 2 }, tags: ['holy', 'nature', 'meditation'] },
                { text: "演奏樂器，說故事娛樂大家。", scores: { bard: 3 }, tags: ['social', 'performance'] },
                { text: "研讀魔法卷軸或與你的守護靈溝通。", scores: { wizard: 2, warlock: 2 }, tags: ['magic', 'knowledge', 'dark'] }
            ]
        },
        {
            text: "9. 你對於「法律」與「規則」的看法是？",
            options: [
                { text: "規則必須被遵守，秩序是社會的基石。", scores: { paladin: 3, monk: 2, cleric: 1 }, tags: ['lawful', 'discipline'] },
                { text: "規則是參考用的，看情況打破它。", scores: { rogue: 3, bard: 2, warlock: 1 }, tags: ['chaotic', 'utility'] },
                { text: "我不關心人類的法律，我只遵循自然的法則。", scores: { druid: 3, barbarian: 2, ranger: 1 }, tags: ['nature', 'neutral'] },
                { text: "只要能達成目的，規則並不重要。", scores: { sorcerer: 1, warlock: 1 }, tags: ['chaotic', 'ambitious'] }
            ]
        },
        {
            text: "10. 如果你能變成一種動物，你想變成？",
            options: [
                { text: "巨熊或猛虎，充滿力量。", scores: { druid: 3, barbarian: 2 }, tags: ['nature', 'melee', 'tank'] },
                { text: "老鷹或獵鷹，視野遼闊。", scores: { ranger: 2, monk: 1 }, tags: ['nature', 'perception', 'mobility'] },
                { text: "毒蛇或黑貓，隱密危險。", scores: { rogue: 2, warlock: 1 }, tags: ['stealth', 'dark'] },
                { text: "我不變身，我召喚神聖的靈體。", scores: { cleric: 1, paladin: 1 }, tags: ['holy', 'summon'] }
            ]
        },
        {
            text: "11. 你的戰鬥風格傾向於？",
            options: [
                { text: "簡單粗暴，攻擊就是最好的防禦。", scores: { barbarian: 3, fighter: 1 }, tags: ['simple', 'aggressive', 'melee'] },
                { text: "千變萬化，使用各種道具與法術控場。", scores: { wizard: 2, bard: 2, druid: 1 }, tags: ['complex', 'control', 'utility'] },
                { text: "精準致命，追求一擊必殺。", scores: { rogue: 3, paladin: 1, ranger: 1 }, tags: ['damage', 'crit', 'sniper'] },
                { text: "連綿不絕，用快速的拳腳壓制對手。", scores: { monk: 3 }, tags: ['melee', 'mobility', 'control'] }
            ]
        },
        {
            text: "12. 當你需要情報時，你會？",
            options: [
                { text: "去酒館請大家喝酒，聽聽流言蜚語。", scores: { bard: 3, rogue: 1 }, tags: ['social', 'urban'] },
                { text: "跟蹤目標，潛入他們的房間。", scores: { rogue: 3, ranger: 1 }, tags: ['stealth', 'investigation'] },
                { text: "使用預言法術直接詢問超自然存在。", scores: { cleric: 2, wizard: 1, warlock: 1 }, tags: ['magic', 'divination'] },
                { text: "抓住一個俘虜，逼問他。", scores: { barbarian: 2, fighter: 1 }, tags: ['intimidation', 'aggressive'] }
            ]
        },
        {
            text: "13. 你最痛恨的敵人是？",
            options: [
                { text: "破壞自然平衡的怪物。", scores: { druid: 3, ranger: 3 }, tags: ['nature', 'balance'] },
                { text: "不死生物與褻瀆神靈者。", scores: { cleric: 3, paladin: 3 }, tags: ['holy', 'undead-slayer'] },
                { text: "愚蠢且沒有榮譽感的強盜。", scores: { fighter: 1, monk: 1 }, tags: ['discipline', 'honor'] },
                { text: "任何阻礙我獲得知識或力量的人。", scores: { wizard: 1, warlock: 2 }, tags: ['knowledge', 'power'] }
            ]
        },
        {
            text: "14. 在隊伍中，你是什麼角色？",
            options: [
                { text: "隊長/發言人。", scores: { paladin: 2, bard: 2 }, tags: ['social', 'leadership'] },
                { text: "智囊團/百科全書。", scores: { wizard: 3, cleric: 1 }, tags: ['knowledge', 'utility'] },
                { text: "斥候/探路者。", scores: { ranger: 3, rogue: 2 }, tags: ['stealth', 'perception'] },
                { text: "打手/保鑣。", scores: { barbarian: 2, fighter: 2 }, tags: ['tank', 'melee', 'damage'] }
            ]
        },
        {
            text: "15. 對於魔法物品，你比較喜歡？",
            options: [
                { text: "一把會燃燒的魔法巨劍。", scores: { fighter: 2, barbarian: 2, paladin: 2 }, tags: ['melee', 'damage', 'weapon'] },
                { text: "一根能增強法術威力的法杖。", scores: { wizard: 2, sorcerer: 2, warlock: 1 }, tags: ['magic', 'damage'] },
                { text: "一件能隱形或飛行的斗篷。", scores: { rogue: 2, ranger: 1 }, tags: ['stealth', 'mobility'] },
                { text: "一個能召喚幫手或治癒傷口的護符。", scores: { cleric: 2, druid: 2 }, tags: ['support', 'summon', 'healing'] }
            ]
        },
        {
            text: "16. 當你生氣時，你會？",
            options: [
                { text: "理智斷線，進入狂暴狀態。", scores: { barbarian: 3 }, tags: ['aggressive', 'chaos'] },
                { text: "冷靜下來，策劃復仇。", scores: { rogue: 1, wizard: 1 }, tags: ['complex', 'planning'] },
                { text: "釋放破壞性的能量波。", scores: { sorcerer: 2, warlock: 1 }, tags: ['magic', 'damage', 'chaos'] },
                { text: "深呼吸，控制情緒。", scores: { monk: 3 }, tags: ['discipline', 'calm'] }
            ]
        },
        {
            text: "17. 你希望世人如何記住你？",
            options: [
                { text: "一個無人能敵的傳奇戰士。", scores: { fighter: 2, barbarian: 1 }, tags: ['physical', 'legend'] },
                { text: "一個通曉古今的大法師。", scores: { wizard: 3 }, tags: ['knowledge', 'magic'] },
                { text: "一個守護弱者與正義的聖徒。", scores: { paladin: 3, cleric: 2 }, tags: ['holy', 'hero'] },
                { text: "我的故事將在歌謠中被傳唱千年。", scores: { bard: 3 }, tags: ['social', 'fame'] }
            ]
        },
        {
            text: "18. 你是否有信仰？",
            options: [
                { text: "我即是神之手，執行神的意志。", scores: { cleric: 3, paladin: 2 }, tags: ['holy', 'divine'] },
                { text: "我尊重大自然與元素之靈。", scores: { druid: 3, barbarian: 1, ranger: 1 }, tags: ['nature', 'elemental'] },
                { text: "我相信我自己，還有我的拳頭。", scores: { monk: 2, fighter: 1 }, tags: ['physical', 'self'] },
                { text: "我與某個存在有個...協議。", scores: { warlock: 3 }, tags: ['dark', 'pact'] }
            ]
        },
        {
            text: "19. 面對陷阱重重的地城，你的對策是？",
            options: [
                { text: "用高超的感知能力提前發現。", scores: { ranger: 2, monk: 1, cleric: 1 }, tags: ['perception', 'cautious'] },
                { text: "派召喚生物或使魔去探路。", scores: { wizard: 1, warlock: 1, druid: 1 }, tags: ['summon', 'magic', 'utility'] },
                { text: "我有特殊的技巧可以拆除它們。", scores: { rogue: 3 }, tags: ['utility', 'skill'] },
                { text: "硬扛過去，反正我不怕痛。", scores: { barbarian: 2 }, tags: ['tank', 'simple'] }
            ]
        },
        {
            text: "20. 你的服裝風格通常是？",
            options: [
                { text: "重型板甲，閃閃發光。", scores: { paladin: 3, fighter: 2, cleric: 1 }, tags: ['tank', 'heavy-armor'] },
                { text: "輕便的皮甲，便於活動。", scores: { rogue: 2, ranger: 2, warlock: 1 }, tags: ['mobility', 'light-armor'] },
                { text: "樸素的長袍或布衣。", scores: { wizard: 1, sorcerer: 1, monk: 2 }, tags: ['magic', 'cloth'] },
                { text: "獸皮或以樹葉裝飾的服裝。", scores: { barbarian: 2, druid: 2 }, tags: ['nature', 'wild'] }
            ]
        },
        {
            text: "21. 在魔法的使用上，你偏好？",
            options: [
                { text: "我不怎麼用魔法，武器比較實在。", scores: { fighter: 2, barbarian: 2, rogue: 1 }, tags: ['physical', 'melee', 'no-magic'] },
                { text: "我能施展少數但威力強大的招式。", scores: { warlock: 2, sorcerer: 1 }, tags: ['damage', 'simple', 'magic'] },
                { text: "我準備多種法術以應對不同情況。", scores: { wizard: 3, cleric: 1, druid: 1 }, tags: ['utility', 'complex', 'magic'] },
                { text: "我用魔法來強化我的攻擊或魅惑敵人。", scores: { bard: 1, paladin: 1, ranger: 1 }, tags: ['support', 'control', 'hybrid'] }
            ]
        },
        {
            text: "22. 你的過去通常涉及？",
            options: [
                { text: "在荒野中獨自生存。", scores: { ranger: 3, barbarian: 1, druid: 1 }, tags: ['nature', 'survival'] },
                { text: "在學院或塔樓中學習。", scores: { wizard: 2, bard: 1 }, tags: ['knowledge', 'study'] },
                { text: "在修道院或教會中長大。", scores: { monk: 2, cleric: 2, paladin: 1 }, tags: ['holy', 'discipline'] },
                { text: "在街頭打滾，學習生存法則。", scores: { rogue: 2, sorcerer: 1 }, tags: ['urban', 'rogue-ish'] }
            ]
        },
        {
            text: "23. 遇到無法戰勝的敵人時？",
            options: [
                { text: "犧牲自己斷後。", scores: { paladin: 2, fighter: 1 }, tags: ['tank', 'heroic'] },
                { text: "施展傳送術帶大家跑。", scores: { wizard: 2, sorcerer: 1 }, tags: ['magic', 'utility', 'teleport'] },
                { text: "躲起來，等待時機。", scores: { rogue: 2, ranger: 1 }, tags: ['stealth', 'patience'] },
                { text: "不可能！我絕不退縮！(然後戰死)", scores: { barbarian: 3 }, tags: ['aggressive', 'stubborn'] }
            ]
        },
        {
            text: "24. 你對金錢的態度？",
            options: [
                { text: "錢是身外之物，夠用就好。", scores: { monk: 3, druid: 2 }, tags: ['ascetic', 'neutral'] },
                { text: "越多越好，我喜歡亮晶晶的東西。", scores: { rogue: 2, warlock: 1, bard: 1 }, tags: ['greed', 'social'] },
                { text: "我會捐給神殿或需要幫助的人。", scores: { cleric: 2, paladin: 2 }, tags: ['good', 'support'] },
                { text: "拿來買更好的裝備或施法材料。", scores: { wizard: 2, fighter: 1 }, tags: ['power', 'prep'] }
            ]
        },
        {
            text: "25. 最後，用一個詞形容你嚮往的冒險風格？",
            options: [
                { text: "熱血與榮耀。", scores: { fighter: 2, paladin: 2, barbarian: 2 }, tags: ['melee', 'tank', 'hero'] },
                { text: "神秘與探索。", scores: { wizard: 2, warlock: 2, sorcerer: 2 }, tags: ['magic', 'knowledge', 'mystery'] },
                { text: "自由與自然。", scores: { druid: 2, ranger: 2, bard: 1 }, tags: ['nature', 'freedom', 'mobility'] },
                { text: "信仰與奉獻。", scores: { cleric: 2, monk: 2 }, tags: ['holy', 'discipline', 'devotion'] }
            ]
        }
    ];

    // 職業與子職業詳細資料 (包含 PHB, XGE, TCE)
    const classInfo = {
        barbarian: {
            title: "野蠻人 (Barbarian)",
            icon: "<i class='fas fa-axe'></i>",
            flavor: "憤怒的化身，原始力量的展現者。",
            desc: "你依靠直覺與怒火戰鬥，是戰場上最堅韌的存在。",
            subclasses: [
                { name: "狂戰士道途 (Berserker)", desc: "[PHB] 純粹的暴力與無視痛苦，適合簡單直接的戰鬥風格。", tags: ['simple', 'melee', 'damage', 'aggressive'] },
                { name: "圖騰勇士 (Totem Warrior)", desc: "[PHB] 與動物靈體連結，獲得極高的生存力（如熊圖騰）。", tags: ['nature', 'tank', 'survival'] },
                { name: "先祖守衛 (Ancestral Guardian)", desc: "[XGE] 召喚祖靈保護隊友，適合想當坦克的玩家。", tags: ['support', 'tank', 'ghost'] },
                { name: "狂熱者道途 (Zealot)", desc: "[XGE] 被神力灌注，甚至能拒絕死亡，傷害極高。", tags: ['holy', 'damage', 'immortal'] },
                { name: "野獸道途 (Beast)", desc: "[TCE] 變出利爪、獠牙或尾巴進行攻擊，適應性強。", tags: ['nature', 'melee', 'transform'] }
            ]
        },
        bard: {
            title: "吟遊詩人 (Bard)",
            icon: "<i class='fas fa-music'></i>",
            flavor: "戰場上的藝術家，用言語編織魔法。",
            desc: "多才多藝的輔助者，擅長控制戰局與激勵隊友。",
            subclasses: [
                { name: "逸聞學院 (Lore)", desc: "[PHB] 追求極致的知識，能學習任何職業的法術，法術控首選。", tags: ['magic', 'knowledge', 'utility', 'support'] },
                { name: "勇氣學院 (Valor)", desc: "[PHB] 能拿盾牌的戰鬥詩人，在前線激勵隊友。", tags: ['melee', 'support', 'hybrid'] },
                { name: "劍舞學院 (Swords)", desc: "[XGE] 華麗的劍術大師，高機動性與攻擊力。", tags: ['melee', 'damage', 'mobility', 'urban'] },
                { name: "辯才學院 (Eloquence)", desc: "[TCE] 說服力與嘴砲能力的頂點，社交與控場的神。", tags: ['social', 'control', 'manipulation'] }
            ]
        },
        cleric: {
            title: "牧師 (Cleric)",
            icon: "<i class='fas fa-cross'></i>",
            flavor: "諸神的代理人，生與死的掌控者。",
            desc: "穿著盔甲的施法者，兼具治療、輸出與防禦能力。",
            subclasses: [
                { name: "生命領域 (Life)", desc: "[PHB] 極致的治療者，沒有人會死在你的看守下。", tags: ['healing', 'support', 'simple'] },
                { name: "光明領域 (Light)", desc: "[PHB] 使用神聖火焰轟炸敵人的法術砲台。", tags: ['magic', 'damage', 'fire'] },
                { name: "暴風領域 (Tempest)", desc: "[PHB] 呼喚雷電與風暴，擅長重甲近戰與反傷。", tags: ['melee', 'damage', 'elemental', 'tank'] },
                { name: "暮光領域 (Twilight)", desc: "[TCE] 提供強大的護盾與夜視，目前版本最強輔助之一。", tags: ['support', 'tank', 'dark', 'meta'] },
                { name: "和平領域 (Peace)", desc: "[TCE] 連結隊友分擔傷害並提供加值，團隊的核心。", tags: ['support', 'healing', 'meta'] }
            ]
        },
        druid: {
            title: "德魯伊 (Druid)",
            icon: "<i class='fas fa-leaf'></i>",
            flavor: "自然的守護者，變形與元素的操控者。",
            desc: "與大自然連結，能呼喚雷電或變身成野獸。",
            subclasses: [
                { name: "月亮結社 (Moon)", desc: "[PHB] 專精於戰鬥變身，變成強大的元素或野獸撕裂敵人。", tags: ['melee', 'tank', 'transform', 'simple'] },
                { name: "大地結社 (Land)", desc: "[PHB] 傳統的自然施法者，法術位多樣化。", tags: ['magic', 'utility', 'nature'] },
                { name: "牧人結社 (Shepherd)", desc: "[XGE] 擅長召喚大量的動物與精類生物助戰。", tags: ['summon', 'support', 'nature', 'pet'] },
                { name: "星辰結社 (Stars)", desc: "[TCE] 運用星圖進行遠程攻擊或治療，非常全能。", tags: ['magic', 'range', 'healing', 'meta'] }
            ]
        },
        fighter: {
            title: "戰士 (Fighter)",
            icon: "<i class='fas fa-shield-alt'></i>",
            flavor: "武器大師，戰術與武藝的專家。",
            desc: "戰場上最穩定的輸出與防禦者，精通所有武器。",
            subclasses: [
                { name: "戰鬥大師 (Battle Master)", desc: "[PHB] 使用戰技骰控制戰場，適合喜歡戰術思考的玩家。", tags: ['complex', 'tactics', 'control', 'melee'] },
                { name: "勇士 (Champion)", desc: "[PHB] 追求極致的爆擊率，操作簡單暴力。", tags: ['simple', 'physical', 'crit', 'melee'] },
                { name: "魔能騎士 (Eldritch Knight)", desc: "[PHB] 結合劍術與魔法，高防禦的魔法戰士。", tags: ['magic', 'tank', 'intelligence', 'hybrid'] },
                { name: "武士 (Samurai)", desc: "[XGE] 透過戰鬥精神獲得優勢，爆發力極強且擅長社交。", tags: ['damage', 'social', 'advantage'] },
                { name: "靈能武士 (Psi Warrior)", desc: "[TCE] 使用念力移動物體或保護隊友的絕地武士。", tags: ['magic', 'defense', 'utility'] }
            ]
        },
        monk: {
            title: "武僧 (Monk)",
            icon: "<i class='fas fa-praying-hands'></i>",
            flavor: "氣的修煉者，將肉體鍛鍊至極致。",
            desc: "高機動性與多重攻擊，擅長震懾與干擾敵人。",
            subclasses: [
                { name: "散打宗 (Open Hand)", desc: "[PHB] 經典武僧，擅長擊倒、推飛與控制敵人。", tags: ['melee', 'control', 'classic'] },
                { name: "暗影宗 (Shadow)", desc: "[PHB] 忍者風格，能在陰影中瞬移與施展沈默術。", tags: ['stealth', 'mobility', 'ninja'] },
                { name: "劍聖宗 (Kensei)", desc: "[XGE] 將武器視為身體延伸，攻守兼備。", tags: ['melee', 'damage', 'weapon'] },
                { name: "慈悲宗 (Mercy)", desc: "[TCE] 戴著面具的瘟疫醫生，能用氣治療隊友或毒害敵人。", tags: ['healing', 'damage', 'support'] }
            ]
        },
        paladin: {
            title: "聖武士 (Paladin)",
            icon: "<i class='fas fa-gavel'></i>",
            flavor: "神聖誓言的實踐者，正義的鐵壁。",
            desc: "兼具戰鬥爆發力(至聖斬)與隊伍守護(光環)的強大職業。",
            subclasses: [
                { name: "奉獻之誓 (Devotion)", desc: "[PHB] 經典的白騎士，神聖武器與反制邪惡。", tags: ['holy', 'tank', 'classic', 'good'] },
                { name: "復仇之誓 (Vengeance)", desc: "[PHB] 為了獵殺敵人不擇手段，單體輸出極高。", tags: ['damage', 'aggressive', 'hunting'] },
                { name: "古老之誓 (Ancients)", desc: "[PHB] 綠色騎士，能抵抗法術傷害，守護自然。", tags: ['nature', 'tank', 'magic-resist'] },
                { name: "征服之誓 (Conquest)", desc: "[XGE] 用恐懼統治戰場，讓敵人動彈不得。", tags: ['control', 'fear', 'aggressive'] }
            ]
        },
        ranger: {
            title: "遊俠 (Ranger)",
            icon: "<i class='fas fa-bow-arrow'></i>",
            flavor: "荒野的獵手，邊境的巡邏者。",
            desc: "擅長追蹤、探索與伏擊的半施法者。",
            subclasses: [
                { name: "獵人 (Hunter)", desc: "[PHB] 純粹的傷害輸出者，針對特定類型的敵人。", tags: ['damage', 'simple', 'range'] },
                { name: "幽域追蹤者 (Gloom Stalker)", desc: "[XGE] 黑暗中的刺客，第一回合爆發力極強且隱形。", tags: ['stealth', 'damage', 'ambush', 'dark', 'meta'] },
                { name: "地平線行者 (Horizon Walker)", desc: "[XGE] 守護位面邊界，能在攻擊時瞬間移動。", tags: ['mobility', 'magic', 'teleport'] },
                { name: "群集守衛 (Swarmkeeper)", desc: "[TCE] 控制一群自然精靈(蟲群)來移動敵人或增加傷害。", tags: ['control', 'nature', 'utility'] }
            ]
        },
        rogue: {
            title: "盜賊 (Rogue)",
            icon: "<i class='fas fa-mask'></i>",
            flavor: "陰影中的專家，精通技巧與弱點。",
            desc: "狡詐、高技能與偷襲傷害的代名詞。",
            subclasses: [
                { name: "盜賊 (Thief)", desc: "[PHB] 經典盜賊，擅長攀爬與快速使用道具。", tags: ['mobility', 'utility', 'classic'] },
                { name: "刺客 (Assassin)", desc: "[PHB] 專精於偽裝與第一回合的爆發秒殺。", tags: ['damage', 'stealth', 'crit'] },
                { name: "詭術師 (Arcane Trickster)", desc: "[PHB] 會使用魔法的小偷，能用隱形法師之手惡作劇。", tags: ['magic', 'utility', 'illusion'] },
                { name: "劍客 (Swashbuckler)", desc: "[XGE] 擅長單挑與社交的決鬥者，不依賴隊友也能偷襲。", tags: ['melee', 'social', 'damage'] },
                { name: "魂刃 (Soulknife)", desc: "[TCE] 使用心靈能量具現化匕首，擅長靈能溝通。", tags: ['stealth', 'utility', 'damage', 'meta'] }
            ]
        },
        sorcerer: {
            title: "術士 (Sorcerer)",
            icon: "<i class='fas fa-fire'></i>",
            flavor: "天賦異稟的施法者，魔法是你的本能。",
            desc: "透過超魔技巧(Metamagic)改變法術型態，爆發力強。",
            subclasses: [
                { name: "龍脈血統 (Draconic)", desc: "[PHB] 擁有龍族體質，更硬、更擅長元素傷害。", tags: ['damage', 'tank', 'simple', 'elemental'] },
                { name: "狂野魔法 (Wild Magic)", desc: "[PHB] 魔法不穩定，施法時可能引發隨機效果（好壞參半）。", tags: ['chaos', 'rng', 'fun'] },
                { name: "神聖靈魂 (Divine Soul)", desc: "[XGE] 擁有神性，能使用牧師的治療法術。", tags: ['healing', 'support', 'holy'] },
                { name: "亞伯拉罕之魂 (Aberrant Mind)", desc: "[TCE] 接觸過古神或奪心魔，擅長心靈魔法與觸手。", tags: ['control', 'psychic', 'weird', 'meta'] }
            ]
        },
        warlock: {
            title: "契術師 (Warlock)",
            icon: "<i class='fas fa-skull'></i>",
            flavor: "異界宗主的契約者，禁忌知識的探求者。",
            desc: "與強大存在交易獲得力量，法術位少但短休可回。",
            subclasses: [
                { name: "邪魔宗主 (Fiend)", desc: "[PHB] 經典惡魔契約，獲得火焰法術與擊殺暫時生命。", tags: ['damage', 'fire', 'survival'] },
                { name: "舊日支配者 (Great Old One)", desc: "[PHB] 擅長心靈感應、讀心與精神控制。", tags: ['social', 'control', 'psychic'] },
                { name: "咒劍士 (Hexblade)", desc: "[XGE] 與影界魔兵交易，穿中甲的魔法近戰，單體輸出極高。", tags: ['melee', 'damage', 'crit', 'meta'] },
                { name: "巨靈宗主 (Genie)", desc: "[TCE] 擁有一個可以躲進去的魔法容器，並造成額外元素傷害。", tags: ['utility', 'damage', 'elemental'] }
            ]
        },
        wizard: {
            title: "法師 (Wizard)",
            icon: "<i class='fas fa-hat-wizard'></i>",
            flavor: "奧術的學者，現實規則的編寫者。",
            desc: "透過研讀獲得力量，擁有最廣泛的法術列表與儀式施法。",
            subclasses: [
                { name: "塑能學派 (Evocation)", desc: "[PHB] 專精於火球術等毀滅性魔法，且能保護隊友。", tags: ['damage', 'simple', 'fire'] },
                { name: "防護學派 (Abjuration)", desc: "[PHB] 擅長製造魔法護盾與反制法術，法師中的坦克。", tags: ['tank', 'defense', 'counter'] },
                { name: "預言學派 (Divination)", desc: "[PHB] 預兆骰能直接替換骰子結果，掌控命運。", tags: ['control', 'utility', 'powerful'] },
                { name: "劍詠學派 (Bladesinging)", desc: "[TCE] 精靈的秘傳武藝，持劍在戰場上如舞蹈般施法。", tags: ['melee', 'defense', 'mobility'] }
            ]
        }
    };

    let currentQuestion = 0;
    let userAnswers = []; // 紀錄選擇的 index

    function startQuiz() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        
        userAnswers = new Array(questions.length).fill(null);
        currentQuestion = 0;
        
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentQuestion];
        document.getElementById('question-text').innerText = q.text;
        
        const optionsBox = document.getElementById('options-box');
        optionsBox.innerHTML = '';

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            
            if (userAnswers[currentQuestion] === index) {
                btn.classList.add('selected');
            }

            btn.onclick = () => selectOption(index);
            optionsBox.appendChild(btn);
        });

        updateProgress();
        updateNavButtons();
    }

    function selectOption(optionIndex) {
        userAnswers[currentQuestion] = optionIndex;
        
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach((btn, idx) => {
            if (idx === optionIndex) {
                btn.classList.add('selected');
            } else {
                btn.classList.remove('selected');
            }
        });

        updateNavButtons();

        // 稍微延遲自動跳轉
        setTimeout(() => {
            if (userAnswers[currentQuestion] === optionIndex) {
                nextQuestion();
            }
        }, 350); 
    }

    function prevQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            loadQuestion();
        }
    }

    function nextQuestion() {
        if (userAnswers[currentQuestion] !== null) {
            currentQuestion++;
            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                showResult();
            }
        }
    }

    function handleNextClick() {
        nextQuestion();
    }

    function updateNavButtons() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        prevBtn.disabled = (currentQuestion === 0);

        if (userAnswers[currentQuestion] === null) {
            nextBtn.disabled = true;
        } else {
            nextBtn.disabled = false;
        }

        if (currentQuestion === questions.length - 1) {
             nextBtn.innerHTML = '看結果 <i class="fas fa-flag-checkered"></i>';
        } else {
             nextBtn.innerHTML = '下一題 <i class="fas fa-arrow-right"></i>';
        }
    }

    function updateProgress() {
        const pct = ((currentQuestion) / questions.length) * 100;
        document.getElementById('progress-fill').style.width = pct + '%';
    }

    function showResult() {
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        calculateAndDisplayResult();
    }

    // ------------------------------------------------------------------
    // 推薦演算法：計算主職業分數 + 子職業標籤匹配
    // ------------------------------------------------------------------
    function calculateAndDisplayResult() {
        let finalScores = {
            barbarian: 0, bard: 0, cleric: 0, druid: 0, fighter: 0, monk: 0,
            paladin: 0, ranger: 0, rogue: 0, sorcerer: 0, warlock: 0, wizard: 0
        };

        // 統計標籤
        let userTagsCount = {}; 

        userAnswers.forEach((optionIndex, questionIndex) => {
            if (optionIndex !== null) {
                const selectedOpt = questions[questionIndex].options[optionIndex];
                
                // 1. 累加職業分數
                const points = selectedOpt.scores;
                for (let cls in points) {
                    if (finalScores.hasOwnProperty(cls)) {
                        finalScores[cls] += points[cls];
                    }
                }

                // 2. 累加標籤
                if (selectedOpt.tags) {
                    selectedOpt.tags.forEach(tag => {
                        if (!userTagsCount[tag]) userTagsCount[tag] = 0;
                        userTagsCount[tag]++;
                    });
                }
            }
        });

        // 3. 找出最高分的「主職業」
        let maxScore = -1;
        let winners = [];
        
        for (let cls in finalScores) {
            if (finalScores[cls] > maxScore) {
                maxScore = finalScores[cls];
                winners = [cls];
            } else if (finalScores[cls] === maxScore) {
                winners.push(cls);
            }
        }
        
        // 簡單的平局處理：隨機取一個，或者你可以設計更複雜的邏輯
        const winner = winners[0]; 

        const resultClassData = classInfo[winner];
        
        // 4. 計算該主職業下，哪個「子職業」最符合使用者的標籤
        let rankedSubclasses = resultClassData.subclasses.map(sub => {
            let matchScore = 0;
            if (sub.tags) {
                sub.tags.forEach(tag => {
                    // 如果使用者有累積這個標籤，加分
                    if (userTagsCount[tag]) {
                        matchScore += userTagsCount[tag];
                    }
                });
            }
            return { ...sub, matchScore };
        });

        // 排序：分數高 -> 低
        rankedSubclasses.sort((a, b) => b.matchScore - a.matchScore);

        // 5. 渲染畫面
        document.getElementById('result-icon').innerHTML = resultClassData.icon;
        document.getElementById('result-title').innerText = resultClassData.title;
        document.getElementById('result-flavor').innerText = resultClassData.flavor;
        document.getElementById('result-description').innerText = resultClassData.desc;
        
        const subList = document.getElementById('subclass-recommendations');
        subList.innerHTML = '';

        // 顯示前 3 名
        rankedSubclasses.slice(0, 3).forEach((sub, index) => {
            const div = document.createElement('div');
            
            let badge = '';
            // 第一名特殊樣式
            if (index === 0) {
                div.className = 'subclass-item best-match';
                badge = ' <span style="color:var(--accent-color); font-size:0.85em; margin-left:5px;"><i class="fas fa-crown"></i> 最佳適性</span>';
            } else {
                div.className = 'subclass-item';
            }

            div.innerHTML = `
                <strong>${sub.name}${badge}</strong>
                <p>${sub.desc}</p>
            `;
            subList.appendChild(div);
        });
    }

    function restartQuiz() {
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('start-screen').style.display = 'block';
    }
</script>

</body>
</html>
