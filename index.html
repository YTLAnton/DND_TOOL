<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5E 職業適性測驗</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #c0392b;
            --secondary-color: #2c3e50;
            --accent-color: #f1c40f;
            --text-color: #ecf0f1;
            --bg-color: #1a1a1d;
            --card-bg: #2d3436;
            --disabled-color: #7f8c8d;
            --highlight-bg: rgba(241, 196, 15, 0.15);
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #4b130f, #2c3e50);
            width: 100%;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border-bottom: 3px solid var(--accent-color);
            box-sizing: border-box;
        }

        h1 {
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px #000;
            line-height: 1.2;
        }

        p.subtitle {
            color: #bdc3c7;
            margin-top: 0.5rem;
            font-size: 1rem;
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #start-screen,
        #quiz-container,
        .result-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            padding: 3rem;
        }

        #start-screen {
            text-align: center;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin-top: 2rem;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
        }

        .btn:hover {
            background-color: #e74c3c;
            transform: scale(1.05);
        }

        #quiz-container {
            display: none;
            position: relative;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .option-btn {
            background-color: #34495e;
            color: var(--text-color);
            border: 1px solid #4a69bd;
            padding: 1rem 1.5rem;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            background-color: #4a69bd;
            transform: translateX(5px);
        }

        .option-btn.selected {
            background-color: #4a69bd;
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.6);
            font-weight: bold;
        }

        .option-btn:focus {
            outline: 2px solid #7f8c8d;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .option-btn.selected:focus {
            outline: none;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid #7f8c8d;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            flex: 1;
        }

        .nav-btn:hover:not(:disabled) {
            background-color: #34495e;
            border-color: var(--text-color);
        }

        .nav-btn:disabled {
            background-color: #2c3e50;
            color: var(--disabled-color);
            border-color: #444;
            cursor: not-allowed;
            opacity: 0.6;
        }

        #result-screen {
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            text-align: center;
            border-top: 5px solid var(--accent-color);
        }

        .class-icon {
            font-size: 4rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .result-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .result-subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .result-desc {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            text-align: left;
            background: rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            border-radius: 10px;
        }

        .subclass-box {
            text-align: left;
            margin-top: 2rem;
            border-top: 1px solid #555;
            padding-top: 1rem;
        }

        .subclass-title {
            color: var(--accent-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
            padding-bottom: 0.5rem;
        }

        .subclass-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            transition: transform 0.2s;
        }

        .subclass-item strong {
            color: #fff;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .subclass-item p {
            margin: 0;
            color: #bdc3c7;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .subclass-item.best-match {
            background: var(--highlight-bg);
            border-left: 4px solid var(--accent-color);
            transform: scale(1.02);
        }

        .footer {
            margin-top: 2rem;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-bottom: 2rem;
        }

        @media (min-width:768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }

            .nav-btn {
                flex: 0 0 auto;
                min-width: 120px;
            }
        }

        @media (max-width:600px) {
            h1 {
                font-size: 1.8rem;
            }

            .container {
                width: 95%;
                margin: 1rem auto;
            }

            #start-screen,
            #quiz-container,
            .result-card {
                padding: 1.5rem 1rem;
            }

            .question-text {
                font-size: 1.2rem;
                margin-bottom: 1.5rem;
            }

            .option-btn {
                padding: 1rem;
                font-size: 1rem;
            }

            .result-title {
                font-size: 2rem;
            }
        }

        /* Toast 樣式 */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #e74c3c;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <header>
        <h1><i class="fas fa-dice-d20"></i> D&D 5E 職業適性測驗</h1>
        <p class="subtitle">探索適合你的職業與子職業 (包含 TCE/XGE 擴充)</p>
    </header>

    <div class="container">
        <div id="start-screen">
            <h2>冒險者，歡迎來到費倫大陸</h2>
            <p>這份測驗根據你選擇的戰鬥風格、決策模式與內在價值觀，從 12 個基礎職業中鎖定適合的職業，並推薦子職業。</p>
            <button class="btn" onclick="startQuiz()">開始測驗</button>
        </div>

        <div id="quiz-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div id="question-box">
                <h3 class="question-text" id="question-text">題目載入中...</h3>
                <div class="options-grid" id="options-box">
                </div>

                <div class="nav-buttons">
                    <button id="prev-btn" class="nav-btn" onclick="prevQuestion()"><i class="fas fa-arrow-left"></i>
                        上一題</button>
                    <button id="next-btn" class="nav-btn" onclick="nextQuestion()">下一題 <i
                            class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <div id="result-screen">
            <div class="result-card">
                <div class="class-icon" id="result-icon"></div>
                <h2 class="result-title" id="result-title"></h2>
                <p class="result-subtitle" id="result-flavor"></p>

                <div class="result-desc" id="result-description"></div>

                <div class="subclass-box">
                    <h3 class="subclass-title">命運指引：推薦子職業</h3>
                    <div id="subclass-recommendations"></div>
                </div>

                <button class="btn" onclick="restartQuiz()">重新測驗</button>
                <br><br>
            </div>
        </div>
    </div>

    <!-- Toast 容器 -->
    <div id="toast"></div>

    <div class="footer">
        <p>Designed based on D&D 5E Rules (PHB, XGE, TCE).</p>
    </div>

    <script>
        // Data (Compressed)
        const questions = [["1. 當你遇到一扇深鎖的厚重木門，而門後可能藏有寶藏，你的第一直覺是？", [["一腳踹開它！省時省力。", { "barbarian": 3, "fighter": 1, "paladin": 1 }, ["simple", "melee", "aggressive"]], ["拿出開鎖工具，安靜且優雅地打開它。", { "rogue": 3, "bard": 1, "ranger": 1 }, ["stealth", "utility"]], ["施展魔法將鎖融化或傳送進去。", { "wizard": 2, "sorcerer": 2, "warlock": 1 }, ["magic", "utility"]], ["仔細觀察周圍是否有機關或鑰匙。", { "monk": 2, "cleric": 1, "druid": 1 }, ["utility", "cautious", "perception"]]]], ["2. 在戰鬥中，你更喜歡站在什麼位置？", [["衝在最前線，與敵人面對面肉搏。", { "barbarian": 3, "fighter": 2, "paladin": 2, "monk": 1 }, ["melee", "tank"]], ["站在後方，用強大的法術轟炸敵人。", { "wizard": 3, "sorcerer": 3, "warlock": 2 }, ["magic", "range", "damage"]], ["遊走於戰場邊緣，尋找偷襲或射擊的機會。", { "rogue": 3, "ranger": 3, "monk": 1 }, ["stealth", "range", "mobility"]], ["在隊伍中間，隨時準備治療隊友或支援戰局。", { "cleric": 3, "bard": 2, "druid": 2 }, ["support", "healing"]]]], ["3. 你的力量來源是什麼？", [["透過經年累月的嚴格鍛鍊與武藝修習。", { "fighter": 3, "monk": 3, "rogue": 1 }, ["physical", "discipline"]], ["與生俱來的血統或天賦。", { "sorcerer": 3, "barbarian": 1 }, ["magic", "innate"]], ["來自神祇、大自然或崇高誓言的賜福。", { "cleric": 3, "paladin": 3, "druid": 3, "warlock": 1 }, ["holy", "nature", "divine"]], ["透過研讀古籍與知識獲得的奧秘。", { "wizard": 3, "bard": 1 }, ["magic", "knowledge"]]]], ["4. 如果隊友受了重傷，你會怎麼做？", [["立刻施展治癒法術，這是我的職責。", { "cleric": 3, "druid": 2, "bard": 1, "paladin": 1 }, ["healing", "support", "holy"]], ["站在他身前，擋下攻擊，保護他撤退。", { "paladin": 3, "fighter": 2, "barbarian": 2 }, ["tank", "defense"]], ["憤怒地將傷害他的敵人撕成碎片。", { "barbarian": 3, "warlock": 1 }, ["damage", "aggressive", "revenge"]], ["使用藥水或急救包，或者用魔法道具。", { "rogue": 1, "ranger": 1 }, ["utility", "item"]]]], ["5. 你最喜歡在哪種環境下冒險？", [["茂密的森林或荒野，遠離文明。", { "druid": 3, "ranger": 3, "barbarian": 2 }, ["nature", "survival"]], ["繁華的城市，充滿人群與政治鬥爭。", { "bard": 3, "rogue": 2, "wizard": 1 }, ["social", "urban"]], ["陰暗的地下城或古代遺跡。", { "rogue": 2, "fighter": 1, "warlock": 1 }, ["stealth", "dungeon", "dark"]], ["神聖的神殿或修道院。", { "cleric": 3, "paladin": 2, "monk": 2 }, ["holy", "discipline"]]]], ["6. 面對一個強大惡魔領主的威脅，你會試圖？", [["與它簽訂契約，換取更強大的力量。", { "warlock": 3, "sorcerer": 1 }, ["dark", "power", "risk"]], ["以神聖的光芒將它淨化驅逐。", { "paladin": 3, "cleric": 3 }, ["holy", "damage"]], ["分析它的弱點，用針對性的法術攻擊。", { "wizard": 3, "ranger": 1 }, ["knowledge", "tactics"]], ["嘲笑它，干擾它的注意力，讓隊友進攻。", { "bard": 3, "rogue": 1 }, ["social", "control"]]]], ["7. 你認為什麼是解決問題的最佳工具？", [["一把鋒利的大斧或巨劍。", { "barbarian": 3, "fighter": 2 }, ["melee", "simple", "damage"]], ["一本寫滿咒語的法術書。", { "wizard": 3 }, ["magic", "utility", "complex"]], ["三寸不爛之舌與個人魅力。", { "bard": 3, "sorcerer": 2, "warlock": 1 }, ["social", "manipulation"]], ["敏銳的直覺與隱密的行動。", { "rogue": 3, "ranger": 2, "monk": 1 }, ["stealth", "perception"]]]], ["8. 休息時間（長休）你通常在做什麼？", [["保養武器和盔甲，保持最佳狀態。", { "fighter": 2, "paladin": 2 }, ["discipline", "physical"]], ["祈禱、冥想，或與自然連結。", { "cleric": 2, "monk": 2, "druid": 2 }, ["holy", "nature", "meditation"]], ["演奏樂器，說故事娛樂大家。", { "bard": 3 }, ["social", "performance"]], ["研讀魔法卷軸或與你的守護靈溝通。", { "wizard": 2, "warlock": 2 }, ["magic", "knowledge", "dark"]]]], ["9. 你對於「法律」與「規則」的看法是？", [["規則必須被遵守，秩序是社會的基石。", { "paladin": 3, "monk": 2, "cleric": 1 }, ["lawful", "discipline"]], ["規則是參考用的，看情況打破它。", { "rogue": 3, "bard": 2, "warlock": 1 }, ["chaotic", "utility"]], ["我不關心人類的法律，我只遵循自然的法則。", { "druid": 3, "barbarian": 2, "ranger": 1 }, ["nature", "neutral"]], ["只要能達成目的，規則並不重要。", { "sorcerer": 1, "warlock": 1 }, ["chaotic", "ambitious"]]]], ["10. 如果你能變成一種動物，你想變成？", [["巨熊或猛虎，充滿力量。", { "druid": 3, "barbarian": 2 }, ["nature", "melee", "tank"]], ["老鷹或獵鷹，視野遼闊。", { "ranger": 2, "monk": 1 }, ["nature", "perception", "mobility"]], ["毒蛇或黑貓，隱密危險。", { "rogue": 2, "warlock": 1 }, ["stealth", "dark"]], ["我不變身，我召喚神聖的靈體。", { "cleric": 1, "paladin": 1 }, ["holy", "summon"]]]], ["11. 你的戰鬥風格傾向於？", [["簡單粗暴，攻擊就是最好的防禦。", { "barbarian": 3, "fighter": 1 }, ["simple", "aggressive", "melee"]], ["千變萬化，使用各種道具與法術控場。", { "wizard": 2, "bard": 2, "druid": 1 }, ["complex", "control", "utility"]], ["精準致命，追求一擊必殺。", { "rogue": 3, "paladin": 1, "ranger": 1 }, ["damage", "crit", "sniper"]], ["連綿不絕，用快速的拳腳壓制對手。", { "monk": 3 }, ["melee", "mobility", "control"]]]], ["12. 當你需要情報時，你會？", [["去酒館請大家喝酒，聽聽流言蜚語。", { "bard": 3, "rogue": 1 }, ["social", "urban"]], ["跟蹤目標，潛入他們的房間。", { "rogue": 3, "ranger": 1 }, ["stealth", "investigation"]], ["使用預言法術直接詢問超自然存在。", { "cleric": 2, "wizard": 1, "warlock": 1 }, ["magic", "divination"]], ["抓住一個俘虜，逼問他。", { "barbarian": 2, "fighter": 1 }, ["intimidation", "aggressive"]]]], ["13. 你最痛恨的敵人是？", [["破壞自然平衡的怪物。", { "druid": 3, "ranger": 3 }, ["nature", "balance"]], ["不死生物與褻瀆神靈者。", { "cleric": 3, "paladin": 3 }, ["holy", "undead-slayer"]], ["愚蠢且沒有榮譽感的強盜。", { "fighter": 1, "monk": 1 }, ["discipline", "honor"]], ["任何阻礙我獲得知識或力量的人。", { "wizard": 1, "warlock": 2 }, ["knowledge", "power"]]]], ["14. 在隊伍中，你是什麼角色？", [["隊長/發言人。", { "paladin": 2, "bard": 2 }, ["social", "leadership"]], ["智囊團/百科全書。", { "wizard": 3, "cleric": 1 }, ["knowledge", "utility"]], ["斥候/探路者。", { "ranger": 3, "rogue": 2 }, ["stealth", "perception"]], ["打手/保鑣。", { "barbarian": 2, "fighter": 2 }, ["tank", "melee", "damage"]]]], ["15. 對於魔法物品，你比較喜歡？", [["一把會燃燒的魔法巨劍。", { "fighter": 2, "barbarian": 2, "paladin": 2 }, ["melee", "damage", "weapon"]], ["一根能增強法術威力的法杖。", { "wizard": 2, "sorcerer": 2, "warlock": 1 }, ["magic", "damage"]], ["一件能隱形或飛行的斗篷。", { "rogue": 2, "ranger": 1 }, ["stealth", "mobility"]], ["一個能召喚幫手或治癒傷口的護符。", { "cleric": 2, "druid": 2 }, ["support", "summon", "healing"]]]], ["16. 當你生氣時，你會？", [["理智斷線，進入狂暴狀態。", { "barbarian": 3 }, ["aggressive", "chaos"]], ["冷靜下來，策劃復仇。", { "rogue": 1, "wizard": 1 }, ["complex", "planning"]], ["釋放破壞性的能量波。", { "sorcerer": 2, "warlock": 1 }, ["magic", "damage", "chaos"]], ["深呼吸，控制情緒。", { "monk": 3 }, ["discipline", "calm"]]]], ["17. 你希望世人如何記住你？", [["一個無人能敵的傳奇戰士。", { "fighter": 2, "barbarian": 1 }, ["physical", "legend"]], ["一個通曉古今的大法師。", { "wizard": 3 }, ["knowledge", "magic"]], ["一個守護弱者與正義的聖徒。", { "paladin": 3, "cleric": 2 }, ["holy", "hero"]], ["我的故事將在歌謠中被傳唱千年。", { "bard": 3 }, ["social", "fame"]]]], ["18. 你是否有信仰？", [["我即是神之手，執行神的意志。", { "cleric": 3, "paladin": 2 }, ["holy", "divine"]], ["我尊重大自然與元素之靈。", { "druid": 3, "barbarian": 1, "ranger": 1 }, ["nature", "elemental"]], ["我相信我自己，還有我的拳頭。", { "monk": 2, "fighter": 1 }, ["physical", "self"]], ["我與某個存在有個...協議。", { "warlock": 3 }, ["dark", "pact"]]]], ["19. 面對陷阱重重的地城，你的對策是？", [["用高超的感知能力提前發現。", { "ranger": 2, "monk": 1, "cleric": 1 }, ["perception", "cautious"]], ["派召喚生物或使魔去探路。", { "wizard": 1, "warlock": 1, "druid": 1 }, ["summon", "magic", "utility"]], ["我有特殊的技巧可以拆除它們。", { "rogue": 3 }, ["utility", "skill"]], ["硬扛過去，反正我不怕痛。", { "barbarian": 2 }, ["tank", "simple"]]]], ["20. 你的服裝風格通常是？", [["重型板甲，閃閃發光。", { "paladin": 3, "fighter": 2, "cleric": 1 }, ["tank", "heavy-armor"]], ["輕便的皮甲，便於活動。", { "rogue": 2, "ranger": 2, "warlock": 1 }, ["mobility", "light-armor"]], ["樸素的長袍或布衣。", { "wizard": 1, "sorcerer": 1, "monk": 2 }, ["magic", "cloth"]], ["獸皮或以樹葉裝飾的服裝。", { "barbarian": 2, "druid": 2 }, ["nature", "wild"]]]], ["21. 在魔法的使用上，你偏好？", [["我不怎麼用魔法，武器比較實在。", { "fighter": 2, "barbarian": 2, "rogue": 1 }, ["physical", "melee", "no-magic"]], ["我能施展少數但威力強大的招式。", { "warlock": 2, "sorcerer": 1 }, ["damage", "simple", "magic"]], ["我準備多種法術以應對不同情況。", { "wizard": 3, "cleric": 1, "druid": 1 }, ["utility", "complex", "magic"]], ["我用魔法來強化我的攻擊或魅惑敵人。", { "bard": 1, "paladin": 1, "ranger": 1 }, ["support", "control", "hybrid"]]]], ["22. 你的過去通常涉及？", [["在荒野中獨自生存。", { "ranger": 3, "barbarian": 1, "druid": 1 }, ["nature", "survival"]], ["在學院或塔樓中學習。", { "wizard": 2, "bard": 1 }, ["knowledge", "study"]], ["在修道院或教會中長大。", { "monk": 2, "cleric": 2, "paladin": 1 }, ["holy", "discipline"]], ["在街頭打滾，學習生存法則。", { "rogue": 2, "sorcerer": 1 }, ["urban", "rogue-ish"]]]], ["23. 遇到無法戰勝的敵人時？", [["犧牲自己斷後。", { "paladin": 2, "fighter": 1 }, ["tank", "heroic"]], ["施展傳送術帶大家跑。", { "wizard": 2, "sorcerer": 1 }, ["magic", "utility", "teleport"]], ["躲起來，等待時機。", { "rogue": 2, "ranger": 1 }, ["stealth", "patience"]], ["不可能！我絕不退縮！(然後戰死)", { "barbarian": 3 }, ["aggressive", "stubborn"]]]], ["24. 你對金錢的態度？", [["錢是身外之物，夠用就好。", { "monk": 3, "druid": 2 }, ["ascetic", "neutral"]], ["越多越好，我喜歡亮晶晶的東西。", { "rogue": 2, "warlock": 1, "bard": 1 }, ["greed", "social"]], ["我會捐給神殿或需要幫助的人。", { "cleric": 2, "paladin": 2 }, ["good", "support"]], ["拿來買更好的裝備或施法材料。", { "wizard": 2, "fighter": 1 }, ["power", "prep"]]]], ["25. 最後，用一個詞形容你嚮往的冒險風格？", [["熱血與榮耀。", { "fighter": 2, "paladin": 2, "barbarian": 2 }, ["melee", "tank", "hero"]], ["神秘與探索。", { "wizard": 2, "warlock": 2, "sorcerer": 2 }, ["magic", "knowledge", "mystery"]], ["自由與自然。", { "druid": 2, "ranger": 2, "bard": 1 }, ["nature", "freedom", "mobility"]], ["信仰與奉獻。", { "cleric": 2, "monk": 2 }, ["holy", "discipline", "devotion"]]]]].map(q => ({ text: q[0], options: q[1].map(o => ({ text: o[0], scores: o[1], tags: o[2] })) }));

        // 職業與子職業詳細資料 (包含 PHB, XGE, TCE)
        const classInfo = Object.fromEntries(Object.entries({ "barbarian": ["野蠻人 (Barbarian)", "<i class='fas fa-axe'></i>", "憤怒的化身，原始力量的展現者。", "你依靠直覺與怒火戰鬥，是戰場上最堅韌的存在。", [["狂戰士道途 (Berserker)", "[PHB] 純粹的暴力與無視痛苦，適合簡單直接的戰鬥風格。", ["simple", "melee", "damage", "aggressive"]], ["圖騰勇士 (Totem Warrior)", "[PHB] 與動物靈體連結，獲得極高的生存力（如熊圖騰）。", ["nature", "tank", "survival"]], ["先祖守衛 (Ancestral Guardian)", "[XGE] 召喚祖靈保護隊友，適合想當坦克的玩家。", ["support", "tank", "ghost"]], ["狂熱者道途 (Zealot)", "[XGE] 被神力灌注，甚至能拒絕死亡，傷害極高。", ["holy", "damage", "immortal"]], ["野獸道途 (Beast)", "[TCE] 變出利爪、獠牙或尾巴進行攻擊，適應性強。", ["nature", "melee", "transform"]]]], "bard": ["吟遊詩人 (Bard)", "<i class='fas fa-music'></i>", "戰場上的藝術家，用言語編織魔法。", "多才多藝的輔助者，擅長控制戰局與激勵隊友。", [["逸聞學院 (Lore)", "[PHB] 追求極致的知識，能學習任何職業的法術，法術控首選。", ["magic", "knowledge", "utility", "support"]], ["勇氣學院 (Valor)", "[PHB] 能拿盾牌的戰鬥詩人，在前線激勵隊友。", ["melee", "support", "hybrid"]], ["劍舞學院 (Swords)", "[XGE] 華麗的劍術大師，高機動性與攻擊力。", ["melee", "damage", "mobility", "urban"]], ["辯才學院 (Eloquence)", "[TCE] 說服力與嘴砲能力的頂點，社交與控場的神。", ["social", "control", "manipulation"]]]], "cleric": ["牧師 (Cleric)", "<i class='fas fa-cross'></i>", "諸神的代理人，生與死的掌控者。", "穿著盔甲的施法者，兼具治療、輸出與防禦能力。", [["生命領域 (Life)", "[PHB] 極致的治療者，沒有人會死在你的看守下。", ["healing", "support", "simple"]], ["光明領域 (Light)", "[PHB] 使用神聖火焰轟炸敵人的法術砲台。", ["magic", "damage", "fire"]], ["暴風領域 (Tempest)", "[PHB] 呼喚雷電與風暴，擅長重甲近戰與反傷。", ["melee", "damage", "elemental", "tank"]], ["暮光領域 (Twilight)", "[TCE] 提供強大的護盾與夜視，目前版本最強輔助之一。", ["support", "tank", "dark", "meta"]], ["和平領域 (Peace)", "[TCE] 連結隊友分擔傷害並提供加值，團隊的核心。", ["support", "healing", "meta"]]]], "druid": ["德魯伊 (Druid)", "<i class='fas fa-leaf'></i>", "自然的守護者，變形與元素的操控者。", "與大自然連結，能呼喚雷電 or 變身成野獸。", [["月亮結社 (Moon)", "[PHB] 專精於戰鬥變身，變成強大的元素或野獸撕裂敵人。", ["melee", "tank", "transform", "simple"]], ["大地結社 (Land)", "[PHB] 傳統的自然施法者，法術位多樣化。", ["magic", "utility", "nature"]], ["牧人結社 (Shepherd)", "[XGE] 擅長召喚大量的動物與精類生物助戰。", ["summon", "support", "nature", "pet"]], ["星辰結社 (Stars)", "[TCE] 運用星圖進行遠程攻擊或治療，非常全能。", ["magic", "range", "healing", "meta"]]]], "fighter": ["戰士 (Fighter)", "<i class='fas fa-shield-alt'></i>", "武器大師，戰術與武藝的專家。", "戰場上最穩定的輸出與防禦者，精通所有武器。", [["戰鬥大師 (Battle Master)", "[PHB] 使用戰技骰控制戰場，適合喜歡戰術思考的玩家。", ["complex", "tactics", "control", "melee"]], ["勇士 (Champion)", "[PHB] 追求極致的爆擊率，操作簡單暴力。", ["simple", "physical", "crit", "melee"]], ["魔能騎士 (Eldritch Knight)", "[PHB] 結合劍術與魔法，高防禦的魔法戰士。", ["magic", "tank", "intelligence", "hybrid"]], ["武士 (Samurai)", "[XGE] 透過戰鬥精神獲得優勢，爆發力極強且擅長社交。", ["damage", "social", "advantage"]], ["靈能武士 (Psi Warrior)", "[TCE] 使用念力移動物體或保護隊友的絕地武士。", ["magic", "defense", "utility"]]]], "monk": ["武僧 (Monk)", "<i class='fas fa-praying-hands'></i>", "氣的修煉者，將肉體鍛鍊至極致。", "高機動性與多重攻擊，擅長震懾與干擾敵人。", [["散打宗 (Open Hand)", "[PHB] 經典武僧，擅長擊倒、推飛與控制敵人。", ["melee", "control", "classic"]], ["暗影宗 (Shadow)", "[PHB] 忍者風格，能在陰影中瞬移與施展沈默術。", ["stealth", "mobility", "ninja"]], ["劍聖宗 (Kensei)", "[XGE] 將武器視為身體延伸，攻守兼備。", ["melee", "damage", "weapon"]], ["慈悲宗 (Mercy)", "[TCE] 戴著面具的瘟疫醫生，能用氣治療隊友或毒害敵人。", ["healing", "damage", "support"]]]], "paladin": ["聖武士 (Paladin)", "<i class='fas fa-gavel'></i>", "神聖誓言的實踐者，正義的鐵壁。", "兼具戰鬥爆發力(至聖斬)與隊伍守護(光環)的強大職業。", [["奉獻之誓 (Devotion)", "[PHB] 經典的白騎士，神聖武器與反制邪惡。", ["holy", "tank", "classic", "good"]], ["復仇之誓 (Vengeance)", "[PHB] 為了獵殺敵人不擇手段，單體輸出極高。", ["damage", "aggressive", "hunting"]], ["古老之誓 (Ancients)", "[PHB] 綠色騎士，能抵抗法術傷害，守護自然。", ["nature", "tank", "magic-resist"]], ["征服之誓 (Conquest)", "[XGE] 用恐懼統治戰場，讓敵人動彈不得。", ["control", "fear", "aggressive"]]]], "ranger": ["遊俠 (Ranger)", "<i class='fas fa-bow-arrow'></i>", "荒野的獵手，邊境的巡邏者。", "擅長追蹤、探索與伏擊的半施法者。", [["獵人 (Hunter)", "[PHB] 純粹的傷害輸出者，針對特定類型的敵人。", ["damage", "simple", "range"]], ["幽域追蹤者 (Gloom Stalker)", "[XGE] 黑暗中的刺客，第一回合爆發力極強且隱形。", ["stealth", "damage", "ambush", "dark", "meta"]], ["地平線行者 (Horizon Walker)", "[XGE] 守護位面邊界，能在攻擊時瞬間移動。", ["mobility", "magic", "teleport"]], ["群集守衛 (Swarmkeeper)", "[TCE] 控制一群自然精靈(蟲群)來移動敵人或增加傷害。", ["control", "nature", "utility"]]]], "rogue": ["盜賊 (Rogue)", "<i class='fas fa-mask'></i>", "陰影中的專家，精通技巧與弱點。", "狡詐、高技能與偷襲傷害的代名詞。", [["盜賊 (Thief)", "[PHB] 經典盜賊，擅長攀爬與快速使用道具。", ["mobility", "utility", "classic"]], ["刺客 (Assassin)", "[PHB] 專精於偽裝與第一回合的爆發秒殺。", ["damage", "stealth", "crit"]], ["詭術師 (Arcane Trickster)", "[PHB] 會使用魔法的小偷，能用隱形法師之手惡作劇。", ["magic", "utility", "illusion"]], ["劍客 (Swashbuckler)", "[XGE] 擅長單挑與社交的決鬥者，不依賴隊友也能偷襲。", ["melee", "social", "damage"]], ["魂刃 (Soulknife)", "[TCE] 使用心靈能量具現化匕首，擅長靈能溝通。", ["stealth", "utility", "damage", "meta"]]]], "sorcerer": ["術士 (Sorcerer)", "<i class='fas fa-fire'></i>", "天賦異稟的施法者，魔法是你的本能。", "透過超魔技巧(Metamagic)改變法術型態，爆發力強。", [["龍脈血統 (Draconic)", "[PHB] 擁有龍族體質，更硬、更擅長元素傷害。", ["damage", "tank", "simple", "elemental"]], ["狂野魔法 (Wild Magic)", "[PHB] 魔法不穩定，施法時可能引發隨機效果（好壞參半）。", ["chaos", "rng", "fun"]], ["神聖靈魂 (Divine Soul)", "[XGE] 擁有神性，能使用牧師的治療法術。", ["healing", "support", "holy"]], ["亞伯拉罕之魂 (Aberrant Mind)", "[TCE] 接觸過古神或奪心魔，擅長心靈魔法與觸手。", ["control", "psychic", "weird", "meta"]]]], "warlock": ["契術師 (Warlock)", "<i class='fas fa-skull'></i>", "異界宗主的契約者，禁忌知識的探求者。", "與強大存在交易獲得力量，法術位少但短休可回。", [["邪魔宗主 (Fiend)", "[PHB] 經典惡魔契約，獲得火焰法術與擊殺暫時生命。", ["damage", "fire", "survival"]], ["舊日支配者 (Great Old One)", "[PHB] 擅長心靈感應、讀心與精神控制。", ["social", "control", "psychic"]], ["咒劍士 (Hexblade)", "[XGE] 與影界魔兵交易，穿中甲的魔法近戰，單體輸出極高。", ["melee", "damage", "crit", "meta"]], ["巨靈宗主 (Genie)", "[TCE] 擁有一個可以躲進去的魔法容器，並造成額外元素傷害。", ["utility", "damage", "elemental"]]]], "wizard": ["法師 (Wizard)", "<i class='fas fa-hat-wizard'></i>", "奧術的學者，現實規則的編寫者。", "透過研讀獲得力量，擁有最廣泛的法術列表與儀式施法。", [["塑能學派 (Evocation)", "[PHB] 專精於火球術等毀滅性魔法，且能保護隊友。", ["damage", "simple", "fire"]], ["防護學派 (Abjuration)", "[PHB] 擅長製造魔法護盾與反制法術，法師中的坦克。", ["tank", "defense", "counter"]], ["預言學派 (Divination)", "[PHB] 預兆骰能直接替換骰子結果，掌控命運。", ["control", "utility", "powerful"]], ["劍詠學派 (Bladesinging)", "[TCE] 精靈的秘傳武藝，持劍在戰場上如舞蹈般施法。", ["melee", "defense", "mobility"]]]] }).map(([k, v]) => [k, { title: v[0], icon: v[1], flavor: v[2], desc: v[3], subclasses: v[4].map(s => ({ name: s[0], desc: s[1], tags: s[2] })) }]));

        let currentQuestion = 0;
        let userAnswers = []; // 紀錄選擇的 index

        /**
         * 顯示 Toast 提示訊息 (防止 Silent Fail)
         * @param {string} message - 提示內容
         */
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'show';
            setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
        }

        /**
         * 開始測驗並重置狀態
         */
        function startQuiz() {
            try {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('quiz-container').style.display = 'block';

                userAnswers = new Array(questions.length).fill(null);
                currentQuestion = 0;

                loadQuestion();
            } catch (error) {
                console.error('startQuiz Error:', error);
                showToast('啟動測驗時發生錯誤，請刷新頁面。');
            }
        }

        /**
         * 載入當前題目與選項
         */
        function loadQuestion() {
            try {
                const q = questions[currentQuestion];
                if (!q) throw new Error('找不到題目數據');

                document.getElementById('question-text').textContent = q.text;

                const optionsBox = document.getElementById('options-box');
                optionsBox.innerHTML = '';

                q.options.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opt.text;

                    if (userAnswers[currentQuestion] === index) {
                        btn.classList.add('selected');
                    }

                    btn.onclick = () => selectOption(index);
                    optionsBox.appendChild(btn);
                });

                updateProgress();
                updateNavButtons();
            } catch (error) {
                console.error('loadQuestion Error:', error);
                showToast('載入題目時發生問題。');
            }
        }

        /**
         * 處理選項點擊
         * @param {number} optionIndex - 所選選項的索引
         */
        function selectOption(optionIndex) {
            try {
                userAnswers[currentQuestion] = optionIndex;

                const buttons = document.querySelectorAll('.option-btn');
                buttons.forEach((btn, idx) => {
                    idx === optionIndex ? btn.classList.add('selected') : btn.classList.remove('selected');
                });

                updateNavButtons();

                // 稍微延遲自動跳轉，提升使用者體驗
                setTimeout(() => {
                    if (userAnswers[currentQuestion] === optionIndex) {
                        nextQuestion();
                    }
                }, 350);
            } catch (error) {
                console.error('selectOption Error:', error);
                showToast('選擇選項時發生錯誤。');
            }
        }

        /**
         * 切換回上一題
         */
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        /**
         * 切換到下一題或結果畫面
         */
        function nextQuestion() {
            try {
                if (userAnswers[currentQuestion] !== null) {
                    currentQuestion++;
                    if (currentQuestion < questions.length) {
                        loadQuestion();
                    } else {
                        showResult();
                    }
                }
            } catch (error) {
                console.error('nextQuestion Error:', error);
                showToast('切換下一題時出錯。');
            }
        }

        /**
         * 更新導航按鈕狀態
         */
        function updateNavButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            prevBtn.disabled = (currentQuestion === 0);
            nextBtn.disabled = (userAnswers[currentQuestion] === null);

            if (currentQuestion === questions.length - 1) {
                nextBtn.innerHTML = '看結果 <i class="fas fa-flag-checkered"></i>';
            } else {
                nextBtn.innerHTML = '下一題 <i class="fas fa-arrow-right"></i>';
            }
        }

        /**
         * 更新進度條
         */
        function updateProgress() {
            const pct = (currentQuestion / questions.length) * 100;
            document.getElementById('progress-fill').style.width = pct + '%';
        }

        /**
         * 切換到結果顯示畫面
         */
        function showResult() {
            try {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('result-screen').style.display = 'block';
                calculateAndDisplayResult();
            } catch (error) {
                console.error('showResult Error:', error);
                showToast('計算結果時發生錯誤。');
            }
        }

        /**
         * 核心演算法：計算主職業分數 + 子職業標籤匹配
         * 包含平局處理邏輯
         */
        function calculateAndDisplayResult() {
            try {
                let finalScores = {
                    barbarian: 0, bard: 0, cleric: 0, druid: 0, fighter: 0, monk: 0,
                    paladin: 0, ranger: 0, rogue: 0, sorcerer: 0, warlock: 0, wizard: 0
                };

                let userTagsCount = {};

                userAnswers.forEach((optionIndex, questionIndex) => {
                    if (optionIndex !== null) {
                        const selectedOpt = questions[questionIndex].options[optionIndex];

                        // 1. 積分累加
                        const points = selectedOpt.scores;
                        for (let cls in points) {
                            if (finalScores.hasOwnProperty(cls)) {
                                finalScores[cls] += points[cls];
                            }
                        }

                        // 2. 標籤累加
                        if (selectedOpt.tags) {
                            selectedOpt.tags.forEach(tag => {
                                userTagsCount[tag] = (userTagsCount[tag] || 0) + 1;
                            });
                        }
                    }
                });

                // 3. 尋找最高分主職業
                let maxScore = -1;
                let winners = [];

                for (let cls in finalScores) {
                    if (finalScores[cls] > maxScore) {
                        maxScore = finalScores[cls];
                        winners = [cls];
                    } else if (finalScores[cls] === maxScore) {
                        winners.push(cls);
                    }
                }

                // 平局處理：若有多個最高分，隨機選一個
                const winner = winners[Math.floor(Math.random() * winners.length)];
                const resultClassData = classInfo[winner];

                // 4. 計算子職業匹配度
                let rankedSubclasses = resultClassData.subclasses.map(sub => {
                    let matchScore = 0;
                    if (sub.tags) {
                        sub.tags.forEach(tag => {
                            if (userTagsCount[tag]) matchScore += userTagsCount[tag];
                        });
                    }
                    return { ...sub, matchScore };
                });

                rankedSubclasses.sort((a, b) => b.matchScore - a.matchScore);

                // 5. 渲染結果畫面 (安全性優化：使用 textContent 與 createElement)
                const iconEl = document.getElementById('result-icon');
                iconEl.innerHTML = resultClassData.icon; // Icon 為靜態數據中的 HTML

                document.getElementById('result-title').textContent = resultClassData.title;
                document.getElementById('result-flavor').textContent = resultClassData.flavor;
                document.getElementById('result-description').textContent = resultClassData.desc;

                const subList = document.getElementById('subclass-recommendations');
                subList.innerHTML = '';

                // 注意：若存在平局職業，可以在此給予額外提示 (可選)
                if (winners.length > 1) {
                    const tieHint = document.createElement('p');
                    tieHint.style.fontSize = '0.85rem';
                    tieHint.style.color = 'var(--disabled-color)';
                    tieHint.textContent = `(你的靈魂也與 ${winners.filter(w => w !== winner).map(w => classInfo[w].title.split(' ')[0]).join('、')} 有所共鳴，但此職業最為契合。)`;
                    subList.appendChild(tieHint);
                }

                rankedSubclasses.slice(0, 3).forEach((sub, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = index === 0 ? 'subclass-item best-match' : 'subclass-item';

                    const strong = document.createElement('strong');
                    strong.textContent = sub.name;
                    if (index === 0) {
                        const crown = document.createElement('span');
                        crown.style.cssText = 'color:var(--accent-color); font-size:0.85em; margin-left:5px;';
                        crown.innerHTML = ' <i class="fas fa-crown"></i> 最佳適性';
                        strong.appendChild(crown);
                    }

                    const p = document.createElement('p');
                    p.textContent = sub.desc;

                    itemDiv.appendChild(strong);
                    itemDiv.appendChild(p);
                    subList.appendChild(itemDiv);
                });
            } catch (error) {
                console.error('calculateResult Error:', error);
                showToast('計算測驗結果時發生邏輯錯誤。');
            }
        }

        /**
         * 重置測驗並回到初始畫面
         */
        function restartQuiz() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block';
        }
    </script>

</body>

</html>